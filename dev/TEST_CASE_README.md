# 重复文本测试用例说明

## 测试用例概述

这个测试用例专门用于测试组件在处理大量重复文本时的准确性，特别是验证位置计算和标记机制是否像 Word 一样可靠。

## 如何访问测试用例

### 方法一：通过 URL 参数

在浏览器中访问：
```
http://localhost:3000?test=true
```

### 方法二：直接修改代码

在 `dev/main.tsx` 中，将 `useTestCase` 设置为 `true`：
```typescript
const useTestCase = true; // 改为 true
```

## 测试用例内容

### 已包含的标注

测试用例预置了 **18 个已标记的"批注"文本**，分布在：
- 标题中（2个）
- 段落中（11个）
- 列表中（3个）
- 其他位置（2个）

### 未标记的文本

测试用例还包含多个**未标记的"批注"文本**，可以用于测试：
- 新标记的准确性
- 位置计算的正确性
- 重复文本的独立标记

## 测试场景

### 1. 已标记文本回显测试

**目标**：验证所有已标记的文本是否正确高亮显示

**步骤**：
1. 打开测试用例页面
2. 检查所有 18 个已标记的"批注"是否都正确高亮
3. 检查侧边栏是否显示 18 个批注卡片
4. 点击每个批注卡片，验证是否能准确跳转到对应位置

**预期结果**：
- ✅ 所有已标记文本都高亮显示
- ✅ 侧边栏显示所有批注
- ✅ 点击批注能准确跳转

### 2. 新标记准确性测试

**目标**：验证新标记是否能准确标记到用户选中的位置

**步骤**：
1. 找到一个未标记的"批注"文本
2. 选中该文本
3. 输入批注内容并确认
4. 检查是否标记到正确的位置
5. 验证不会影响其他已标记的文本

**预期结果**：
- ✅ 新标记准确对应到选中的位置
- ✅ 不会影响其他已标记的文本
- ✅ 批注序号正确递增

### 3. 重复文本独立标记测试

**目标**：验证即使有多个相同的文本，每个标记都独立且准确

**步骤**：
1. 依次标记所有未标记的"批注"文本
2. 每次标记后检查位置是否正确
3. 验证每个标记都独立，互不干扰
4. 检查批注序号是否正确递增

**预期结果**：
- ✅ 每个"批注"都被独立标记
- ✅ 标记位置准确无误
- ✅ 批注序号按顺序递增

### 4. 位置计算准确性测试

**目标**：验证位置计算机制是否像 Word 一样可靠

**步骤**：
1. 标记不同位置的相同文本
2. 验证每个标记都准确对应到选中的位置
3. 检查不会出现位置偏移
4. 验证不会出现重复标记

**预期结果**：
- ✅ 位置计算准确
- ✅ 无位置偏移
- ✅ 无重复标记

## 测试统计

测试用例页面顶部会显示：
- **已标记数量**：当前文档中已标记的文本数量
- **批注数量**：侧边栏中的批注卡片数量
- **未标记"批注"**：文档中未标记的"批注"文本数量

## 边界情况测试

### 连续重复文本

测试标记连续出现的相同文本，例如：
```
<mark_9>批注</mark_9>和<mark_10>批注</mark_10>紧挨着出现
```

### 已标记区域附近

测试在已标记文本附近标记新文本，验证不会相互影响。

### 跨段落标记

测试标记跨越多个段落的文本（如果需要）。

### 特殊字符

测试包含特殊字符的文本标记。

## 预期行为

组件应该表现出类似 Word 的批注行为：

1. **精确位置锁定**：通过起止位置、长度等信息记录位置
2. **独立标记绑定**：即使有完全相同的文本，每个标记都独立绑定到对应位置
3. **准确跳转**：点击批注卡片能瞬间跳转到对应位置
4. **位置信息显示**：每个批注都附带原文片段和位置信息

## 测试结果验证

### 成功标准

- ✅ 所有已标记文本正确高亮
- ✅ 新标记准确对应选中位置
- ✅ 重复文本独立标记，互不干扰
- ✅ 位置计算准确，无偏移
- ✅ 批注序号正确递增
- ✅ 点击批注能准确跳转

### 失败情况

如果出现以下情况，说明存在问题：
- ❌ 标记到错误的位置
- ❌ 重复标记相同的文本
- ❌ 标记位置偏移
- ❌ 影响其他已标记的文本
- ❌ 批注序号错误

## 测试用例文件

- **测试用例 Markdown**：`dev/test-case.md`
- **测试用例组件**：`dev/TestCaseApp.tsx`
- **说明文档**：`dev/TEST_CASE_README.md`

## 使用建议

1. **先测试已标记文本的回显**：确保基础功能正常
2. **再测试新标记的准确性**：验证位置计算是否正确
3. **最后测试重复文本**：验证独立标记机制
4. **检查边界情况**：确保各种场景都能正确处理

通过这个测试用例，可以全面验证组件在处理重复文本时的准确性和可靠性。

